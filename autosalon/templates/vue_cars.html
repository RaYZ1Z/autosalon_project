{% extends "vue_main_base.html" %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π | AutoElite{% endblock %}

{% block extra_css %}
<style>
    /* === –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò === */
    .cars-catalog {
        min-height: 100vh;
        padding: 100px 0 50px;
    }

    .catalog-container {
        max-width: 1400px;
        margin: 0 auto;
    }

    /* === –ó–ê–ì–û–õ–û–í–û–ö === */
    .catalog-header {
        text-align: center;
        margin-bottom: 40px;
        position: relative;
    }

    .catalog-header h1 {
        font-size: 3rem;
        font-weight: 800;
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 15px;
        text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
    }


    /* === –§–ò–õ–¨–¢–†–´ –ò –°–û–†–¢–ò–†–û–í–ö–ê === */
    .controls-panel {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .search-box {
        position: relative;
    }

    .search-box input {
        padding-left: 45px;
        height: 48px;
        border-radius: 10px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        color: #f8fafc;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        width: 100%;
    }

    .search-box input:focus {
        border-color: #fbbf24;
        background: rgba(255, 255, 255, 0.12);
        box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        outline: none;
    }

    .search-box input::placeholder {
        color: #94a3b8;
    }

    .search-icon {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: #fbbf24;
        font-size: 1rem;
        z-index: 2;
    }

    .filter-group {
        margin-bottom: 15px;
    }

    .filter-group label {
        display: block;
        font-weight: 600;
        color: #f8fafc;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }

    .filter-group input,
    .filter-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
        color: #f8fafc;
        font-size: 0.95rem;
        transition: all 0.3s ease;
    }

    .filter-group input:focus,
    .filter-group select:focus {
        border-color: #fbbf24;
        background: rgba(255, 255, 255, 0.12);
        outline: none;
        box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
    }

    .filter-group input::placeholder {
        color: #94a3b8;
    }

    .filter-group select {
        cursor: pointer;
    }

    .filter-group select option {
        background: #1e1b4b;
        color: #f8fafc;
    }

    .sort-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .sort-btn {
        padding: 10px 18px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        color: #cbd5e1;
        font-weight: 500;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 0.9rem;
        position: relative;
        overflow: hidden;
    }

    .sort-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.1), transparent);
        transition: left 0.5s;
    }

    .sort-btn:hover {
        border-color: #fbbf24;
        color: #fbbf24;
        background: rgba(251, 191, 36, 0.05);
        transform: translateY(-2px);
    }

    .sort-btn:hover::before {
        left: 100%;
    }

    .sort-btn.active {
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e1b4b;
        border-color: #fbbf24;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .sort-btn.active:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
    }

    /* === –°–¢–ê–¢–ò–°–¢–ò–ö–ê === */
    .stats-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: white;
        padding: 15px 25px;
        border-radius: 15px;
        margin-bottom: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid #f1f5f9;
    }

    .stats-item {
        text-align: center;
    }

    .stats-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #1a56db;
        line-height: 1;
    }

    .stats-label {
        font-size: 0.85rem;
        color: #64748b;
        margin-top: 5px;
    }

    /* === –ö–ê–†–¢–û–ß–ö–ò –ê–í–¢–û–ú–û–ë–ò–õ–ï–ô === */
    .cars-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .car-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
    }

    .car-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #fbbf24, #f59e0b, #ec4899);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .car-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        background: rgba(255, 255, 255, 0.08);
    }

    .car-card:hover::before {
        opacity: 1;
    }

    .car-image {
        height: 200px;
        background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        position: relative;
        overflow: hidden;
    }

    .car-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
    }

    .car-card:hover .car-image img {
        transform: scale(1.1);
    }

    .car-badges {
        position: absolute;
        top: 15px;
        left: 15px;
        display: flex;
        gap: 8px;
        z-index: 2;
    }

    .car-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        backdrop-filter: blur(10px);
    }

    .badge-year {
        background: rgba(59, 130, 246, 0.9);
        color: white;
    }

    .badge-new {
        background: rgba(34, 197, 94, 0.9);
        color: white;
    }

    .favorite-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.95);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 2;
        color: #ef4444;
        font-size: 1.2rem;
    }

    .favorite-btn:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: 0 5px 15px rgba(239, 68, 68, 0.2);
    }

    .favorite-btn.active {
        background: #ef4444;
        color: white;
    }

    .car-content {
        padding: 25px;
    }

    .car-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #f8fafc;
        margin-bottom: 10px;
        line-height: 1.3;
    }

    .car-price {
        font-size: 1.8rem;
        font-weight: 800;
        color: #fbbf24;
        margin-bottom: 15px;
        text-shadow: 0 2px 10px rgba(251, 191, 36, 0.3);
    }

    .car-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }

    .detail-item {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #cbd5e1;
        font-size: 0.9rem;
    }

    .detail-item i {
        color: #fbbf24;
        font-size: 1rem;
        width: 20px;
    }

    .car-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }

    .btn-view {
        flex: 1;
        padding: 12px;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        color: #1e1b4b;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }

    .btn-view:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(251, 191, 36, 0.4);
    }

    .btn-request {
        padding: 12px 20px;
        background: rgba(255, 255, 255, 0.1);
        color: #fbbf24;
        border: 2px solid #fbbf24;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        flex-shrink: 0;
    }

    .btn-request:hover {
        background: #fbbf24;
        color: #1e1b4b;
        transform: translateY(-2px);
    }

    /* === –°–û–°–¢–û–Ø–ù–ò–Ø === */
    .loading-state {
        text-align: center;
        padding: 80px 20px;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid #e2e8f0;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-state i {
        font-size: 4rem;
        color: #cbd5e1;
        margin-bottom: 20px;
    }

    .error-state {
        text-align: center;
        padding: 40px;
        background: #fef2f2;
        border-radius: 15px;
        border: 1px solid #fecaca;
        color: #dc2626;
    }

    /* === –ü–ê–ì–ò–ù–ê–¶–ò–Ø === */
    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
    }

    .page-btn {
        width: 45px;
        height: 45px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: white;
        color: #64748b;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .page-btn:hover {
        border-color: #3b82f6;
        color: #1a56db;
    }

    .page-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
    }

    /* === –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û === */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        animation: modalSlide 0.3s ease-out;
    }

    .modal-header {
        padding: 25px 30px;
        border-bottom: 1px solid #e2e8f0;
    }

    .modal-body {
        padding: 30px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        font-weight: 600;
        color: #334155;
        margin-bottom: 8px;
    }

    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
        border-color: #3b82f6;
        outline: none;
    }

    .modal-footer {
        padding: 20px 30px;
        border-top: 1px solid #e2e8f0;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
    }

    /* === –ê–ù–ò–ú–ê–¶–ò–ò === */
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes modalSlide {
        from {
            opacity: 0;
            transform: translateY(-30px) scale(0.9);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    /* === –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ === */
    @media (max-width: 768px) {
        .cars-catalog {
            padding: 80px 15px 30px;
        }

        .catalog-header h1 {
            font-size: 2.2rem;
        }

        .controls-panel {
            padding: 20px;
        }

        .stats-bar {
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }

        .cars-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .car-actions {
            flex-direction: column;
        }
    }

    @media (max-width: 480px) {
        .catalog-header h1 {
            font-size: 1.8rem;
        }

        .filter-group {
            margin-bottom: 10px;
        }
    }
</style>
{% endblock %}

{% block vue_content %}
<div class="cars-catalog">
    <div class="container catalog-container">
        <!-- CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ -->
        {% csrf_token %}

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="catalog-header">
            <h1>üöó –ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π</h1>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Vue -->
        <div id="app">
            <!-- Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Vue 3 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Axios –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤ -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
<script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
<!-- –ï—Å–ª–∏ –Ω–µ—Ç FontAwesome, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ -->

{% verbatim %}
<script>
console.log('=== –ö–ê–¢–ê–õ–û–ì –ê–í–¢–û–ú–û–ë–ò–õ–ï–ô - Vue.js –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ===');

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ userStorage
if (!window.userStorage) {
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –≤–µ—Ä—Å–∏—é –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
    window.userStorage = {
        getFavorites: () => JSON.parse(localStorage.getItem('autoelite_favorites') || '[]'),
        addToFavorites: (car) => {
            const favorites = JSON.parse(localStorage.getItem('autoelite_favorites') || '[]');
            if (!favorites.some(f => f.id === car.id)) {
                favorites.push({...car, added_at: new Date().toISOString()});
                localStorage.setItem('autoelite_favorites', JSON.stringify(favorites));
                alert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ!');
                return true;
            }
            return false;
        },
        removeFromFavorites: (carId) => {
            const favorites = JSON.parse(localStorage.getItem('autoelite_favorites') || '[]');
            const newFavorites = favorites.filter(f => f.id !== carId);
            localStorage.setItem('autoelite_favorites', JSON.stringify(newFavorites));
            alert('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ!');
            return true;
        },
        isFavorite: (carId) => {
            const favorites = JSON.parse(localStorage.getItem('autoelite_favorites') || '[]');
            return favorites.some(f => f.id === carId);
        },
        addToHistory: (car) => {
            let history = JSON.parse(localStorage.getItem('autoelite_history') || '[]');
            history = history.filter(h => h.id !== car.id);
            history.unshift({...car, viewed_at: new Date().toISOString()});
            if (history.length > 20) history = history.slice(0, 20);
            localStorage.setItem('autoelite_history', JSON.stringify(history));
        },
        getCurrentUser: () => JSON.parse(localStorage.getItem('autoelite_user') || '{"name":"–ì–æ—Å—Ç—å","email":"guest@example.com"}'),
        showNotification: (msg) => alert(msg)
    };
}

const { createApp, ref, computed, onMounted } = Vue;

createApp({
    setup() {
        // === –°–û–°–¢–û–Ø–ù–ò–Ø ===
        const cars = ref([]);  // –í—Å–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
        const filteredCars = ref([]);  // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
        const loading = ref(true);
        const error = ref(null);

        // –§–∏–ª—å—Ç—Ä—ã
        const searchQuery = ref('');
        const minPrice = ref('');
        const maxPrice = ref('');
        const selectedYear = ref('');
        const selectedFuel = ref('');
        const selectedTransmission = ref('');

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        const sortBy = ref('price');
        const sortOrder = ref('desc');

        // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        const currentPage = ref(1);
        const itemsPerPage = ref(9);

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        const showModal = ref(false);
        const selectedCar = ref(null);
        const requestForm = ref({
            name: '',
            phone: '',
            email: '',
            message: ''
        });

        // === –í–´–ß–ò–°–õ–Ø–ï–ú–´–ï –°–í–û–ô–°–¢–í–ê ===

        // –î–æ—Å—Ç—É–ø–Ω—ã–µ –≥–æ–¥—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
        const availableYears = computed(() => {
            const years = cars.value.map(car => car.year).filter(year => year);
            return [...new Set(years)].sort((a, b) => b - a);
        });

        // –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã —Ç–æ–ø–ª–∏–≤–∞
        const availableFuels = computed(() => {
            const fuels = cars.value.map(car => car.fuel_type).filter(f => f);
            return [...new Set(fuels)];
        });

        // –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ—Ä–æ–±–∫–∏ –ø–µ—Ä–µ–¥–∞—á
        const availableTransmissions = computed(() => {
            const transmissions = cars.value.map(car => car.transmission).filter(t => t);
            return [...new Set(transmissions)];
        });

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const stats = computed(() => {
            const total = filteredCars.value.length;
            const totalPrice = filteredCars.value.reduce((sum, car) => sum + (car.price || 0), 0);
            const avgPrice = total > 0 ? Math.round(totalPrice / total) : 0;
            const avgYear = total > 0 ? Math.round(filteredCars.value.reduce((sum, car) => sum + (car.year || 0), 0) / total) : 0;

            return { total, avgPrice, avgYear };
        });

        // –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
        const sortedCars = computed(() => {
            let result = [...filteredCars.value];

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            result.sort((a, b) => {
                let valA, valB;

                switch(sortBy.value) {
                    case 'price':
                        valA = a.price || 0;
                        valB = b.price || 0;
                        break;
                    case 'year':
                        valA = a.year || 0;
                        valB = b.year || 0;
                        break;
                    case 'mileage':
                        valA = a.mileage || 0;
                        valB = b.mileage || 0;
                        break;
                    default:
                        valA = a.price || 0;
                        valB = b.price || 0;
                }

                return sortOrder.value === 'asc' ? valA - valB : valB - valA;
            });

            return result;
        });

        // –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏
        const paginatedCars = computed(() => {
            const start = (currentPage.value - 1) * itemsPerPage.value;
            const end = start + itemsPerPage.value;
            return sortedCars.value.slice(start, end);
        });

        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
        const totalPages = computed(() => {
            return Math.ceil(sortedCars.value.length / itemsPerPage.value);
        });

        // === –ú–ï–¢–û–î–´ ===

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π
        const loadCars = async () => {
            try {
                loading.value = true;
                error.value = null;
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π —Å API...');

                const response = await axios.get('/api/cars/');
                console.log('–ü–æ–ª—É—á–µ–Ω–æ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:', response.data.length);

                if (response.data && response.data.length > 0) {
                    // –ü–æ–ª—É—á–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                    const syncedFavorites = JSON.parse(localStorage.getItem('autoelite_favorites_sync') || '[]');

                    cars.value = response.data.map(car => ({
                        ...car,
                        brand_name: car.brand?.name || car.brand || '–ù–µ —É–∫–∞–∑–∞–Ω',
                        image_url: (car.images && car.images.length > 0) ? car.images[0].image : null
                    }));

                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                    syncFavoritesFromStorage();
                    applyFilters();

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage
                    updateFavoritesInStorage();
                } else {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                    cars.value = getDemoCars();
                    applyFilters();
                }

            } catch (err) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:', err);
                error.value = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API.';

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                cars.value = getDemoCars();
                applyFilters();

            } finally {
                loading.value = false;
            }
        };

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const applyFilters = () => {
            let result = [...cars.value];

            // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
            if (searchQuery.value) {
                const query = searchQuery.value.toLowerCase();
                result = result.filter(car =>
                    car.brand_name.toLowerCase().includes(query) ||
                    car.model.toLowerCase().includes(query)
                );
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ
            if (minPrice.value) {
                result = result.filter(car => car.price >= parseInt(minPrice.value));
            }
            if (maxPrice.value) {
                result = result.filter(car => car.price <= parseInt(maxPrice.value));
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ–¥—É
            if (selectedYear.value) {
                result = result.filter(car => car.year == selectedYear.value);
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–æ–ø–ª–∏–≤—É
            if (selectedFuel.value) {
                result = result.filter(car => car.fuel_type === selectedFuel.value);
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ—Ä–æ–±–∫–µ –ø–µ—Ä–µ–¥–∞—á
            if (selectedTransmission.value) {
                result = result.filter(car => car.transmission === selectedTransmission.value);
            }

            filteredCars.value = result;
            currentPage.value = 1; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        };

        // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const resetFilters = () => {
            searchQuery.value = '';
            minPrice.value = '';
            maxPrice.value = '';
            selectedYear.value = '';
            selectedFuel.value = '';
            selectedTransmission.value = '';
            applyFilters();
        };

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        const changeSort = (field) => {
            if (sortBy.value === field) {
                sortOrder.value = sortOrder.value === 'asc' ? 'desc' : 'asc';
            } else {
                sortBy.value = field;
                sortOrder.value = 'desc';
            }
        };

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        const toggleFavorite = async (car) => {
            try {
                // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;

                const response = await axios.post('/api/favorites/toggle/', {
                    car_id: car.id
                }, {
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.data.action === 'added') {
                    car.is_favorite = true;
                    window.userStorage.showNotification('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
                } else if (response.data.action === 'removed') {
                    car.is_favorite = false;
                    window.userStorage.showNotification('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
                }

                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage
                updateFavoritesInStorage();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º:', error);
                if (error.response && error.response.status === 401) {
                    window.userStorage.showNotification('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                } else if (error.response && error.response.status === 403) {
                    window.userStorage.showNotification('–û—à–∏–±–∫–∞ CSRF —Ç–æ–∫–µ–Ω–∞');
                } else {
                    window.userStorage.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º');
                }
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è localStorage —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        const updateFavoritesInStorage = () => {
            const favoriteIds = cars.value.filter(car => car.is_favorite).map(car => car.id);
            localStorage.setItem('autoelite_favorites_sync', JSON.stringify(favoriteIds));
        };

        // –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—è
        const viewCarDetails = (car) => {
            window.location.href = `/car/${car.id}/`;
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞—è–≤–∫–∏ - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        const showRequestForm = (car) => {
            window.location.href = `/cars/car/${car.id}/create-request/`;
        };

        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
        const submitRequest = async () => {
            if (!requestForm.value.name || !requestForm.value.phone || !requestForm.value.email) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            try {
                // –ü–æ–ª—É—á–∞–µ–º CSRF —Ç–æ–∫–µ–Ω
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value;

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await axios.post(`/api/cars/${selectedCar.value.id}/create_request/`, {
                    contact_name: requestForm.value.name,
                    contact_phone: requestForm.value.phone,
                    contact_email: requestForm.value.email,
                    message: requestForm.value.message
                }, {
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 201) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    window.userStorage.showNotification('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');

                    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                    window.userStorage.addToHistory(selectedCar.value);

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    showModal.value = false;
                    requestForm.value = { name: '', phone: '', email: '', message: '' };
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏:', error);
                if (error.response && error.response.status === 401) {
                    alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                }
            }
        };

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª
        const formatNumber = (num) => {
            if (num === undefined || num === null) return '0';
            return new Intl.NumberFormat('ru-RU').format(num);
        };

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
        const formatPrice = (price) => {
            return formatNumber(price) + ' ‚ÇΩ';
        };

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–ø–ª–∏–≤–∞
        const getFuelName = (fuelType) => {
            const names = {
                'petrol': '–ë–µ–Ω–∑–∏–Ω',
                'diesel': '–î–∏–∑–µ–ª—å',
                'electric': '–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π',
                'hybrid': '–ì–∏–±—Ä–∏–¥',
                'gas': '–ì–∞–∑'
            };
            return names[fuelType] || fuelType;
        };

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ—Ä–æ–±–∫–∏ –ø–µ—Ä–µ–¥–∞—á
        const getTransmissionName = (transmission) => {
            const names = {
                'manual': '–ú–ö–ü–ü',
                'automatic': '–ê–ö–ü–ü',
                'robot': '–†–æ–±–æ—Ç',
                'variator': '–í–∞—Ä–∏–∞—Ç–æ—Ä'
            };
            return names[transmission] || transmission;
        };

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
        const getIcon = (type, value) => {
            const icons = {
                'fuel': {
                    'petrol': 'fa-gas-pump',
                    'diesel': 'fa-oil-can',
                    'electric': 'fa-bolt',
                    'hybrid': 'fa-car-battery',
                    'gas': 'fa-fire'
                },
                'transmission': {
                    'manual': 'fa-cog',
                    'automatic': 'fa-cogs',
                    'robot': 'fa-microchip',
                    'variator': 'fa-sliders-h'
                }
            };
            return icons[type]?.[value] || 'fa-question';
        };

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
        const getDemoCars = () => {
            return [
                {
                    id: 1,
                    brand: { name: 'Toyota' },
                    brand_name: 'Toyota',
                    model: 'Camry',
                    year: 2022,
                    price: 2500000,
                    mileage: 15000,
                    color: '–ß–µ—Ä–Ω—ã–π',
                    fuel_type: 'petrol',
                    transmission: 'automatic',
                    engine_volume: 2.5,
                    horsepower: 200,
                    created_at: '2023-01-15',
                    images: [{ image: 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341',
                    is_favorite: false
                },
                {
                    id: 2,
                    brand: { name: 'BMW' },
                    brand_name: 'BMW',
                    model: 'X5',
                    year: 2021,
                    price: 5200000,
                    mileage: 45000,
                    color: '–ë–µ–ª—ã–π',
                    fuel_type: 'diesel',
                    transmission: 'automatic',
                    engine_volume: 3.0,
                    horsepower: 300,
                    created_at: '2022-11-20',
                    images: [{ image: 'https://images.unsplash.com/photo-1553440569-bcc63803a83d', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1553440569-bcc63803a83d',
                    is_favorite: false
                },
                {
                    id: 3,
                    brand: { name: 'Audi' },
                    brand_name: 'Audi',
                    model: 'A4',
                    year: 2023,
                    price: 3200000,
                    mileage: 5000,
                    color: '–°–µ—Ä—ã–π',
                    fuel_type: 'petrol',
                    transmission: 'automatic',
                    engine_volume: 2.0,
                    horsepower: 190,
                    created_at: '2023-03-10',
                    images: [{ image: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70',
                    is_favorite: false
                },
                {
                    id: 4,
                    brand: { name: 'Mercedes' },
                    brand_name: 'Mercedes',
                    model: 'E-Class',
                    year: 2020,
                    price: 3800000,
                    mileage: 75000,
                    color: '–°–∏–Ω–∏–π',
                    fuel_type: 'diesel',
                    transmission: 'automatic',
                    engine_volume: 2.2,
                    horsepower: 220,
                    created_at: '2021-08-05',
                    images: [{ image: 'https://images.unsplash.com/photo-1563720223484-21c6c2d3c8e2', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1563720223484-21c6c2d3c8e2',
                    is_favorite: false
                },
                {
                    id: 5,
                    brand: { name: 'Tesla' },
                    brand_name: 'Tesla',
                    model: 'Model S',
                    year: 2023,
                    price: 8500000,
                    mileage: 500,
                    color: '–ö—Ä–∞—Å–Ω—ã–π',
                    fuel_type: 'electric',
                    transmission: 'automatic',
                    engine_volume: 0,
                    horsepower: 670,
                    created_at: '2023-05-12',
                    images: [{ image: 'https://images.unsplash.com/photo-1560958089-b8a1929cea89', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1560958089-b8a1929cea89',
                    is_favorite: false
                },
                {
                    id: 6,
                    brand: { name: 'Lexus' },
                    brand_name: 'Lexus',
                    model: 'RX 350',
                    year: 2022,
                    price: 4500000,
                    mileage: 25000,
                    color: '–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π',
                    fuel_type: 'hybrid',
                    transmission: 'automatic',
                    engine_volume: 3.5,
                    horsepower: 295,
                    created_at: '2022-12-18',
                    images: [{ image: 'https://images.unsplash.com/photo-1533473359331-0135ef1b58bf', is_main: true }],
                    image_url: 'https://images.unsplash.com/photo-1533473359331-0135ef1b58bf',
                    is_favorite: false
                }
            ];
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑ localStorage
        const syncFavoritesFromStorage = () => {
            const syncedFavorites = JSON.parse(localStorage.getItem('autoelite_favorites_sync') || '[]');
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π –≤ —Ç–µ–∫—É—â–µ–º —Å–ø–∏—Å–∫–µ
            cars.value.forEach(car => {
                car.is_favorite = syncedFavorites.includes(car.id);
            });
        };

        // === –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ ===
        onMounted(() => {
            console.log('Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ');
            loadCars();

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            if (!window.userStorage.getCurrentUser()) {
                window.userStorage.login('demo@autoelite.ru', 'demo123');
            }

            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
            window.addEventListener('storage', (e) => {
                if (e.key === 'autoelite_favorites_sync') {
                    syncFavoritesFromStorage();
                }
            });

            // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–æ—à–ª–∏ –≤ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ)
            setInterval(syncFavoritesFromStorage, 2000);
        });

        // === –í–û–ó–í–†–ê–©–ê–ï–ú–´–ï –î–ê–ù–ù–´–ï ===
        return {
            // –°–æ—Å—Ç–æ—è–Ω–∏—è
            cars,
            filteredCars: paginatedCars,
            loading,
            error,
            searchQuery,
            minPrice,
            maxPrice,
            selectedYear,
            selectedFuel,
            selectedTransmission,
            sortBy,
            sortOrder,
            currentPage,
            totalPages,
            showModal,
            selectedCar,
            requestForm,

            // –í—ã—á–∏—Å–ª—è–µ–º—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
            availableYears,
            availableFuels,
            availableTransmissions,
            stats,

            // –ú–µ—Ç–æ–¥—ã
            loadCars,
            applyFilters,
            resetFilters,
            changeSort,
            toggleFavorite,
            viewCarDetails,
            showRequestForm,
            submitRequest,
            formatNumber,
            formatPrice,
            getFuelName,
            getTransmissionName,
            getIcon
        };
    },

    template: `
        <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="controls-panel">
            <div class="row g-2">
                <!-- –ü–æ–∏—Å–∫ -->
                <div class="col-lg-3 col-md-6">
                    <div class="filter-group">
                        <label>–ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä–∫–µ –∏ –º–æ–¥–µ–ª–∏</label>
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input
                                type="text"
                                class="form-control"
                                v-model="searchQuery"
                                @input="applyFilters"
                            >
                        </div>
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä—ã -->
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="filter-group">
                        <label>–¶–µ–Ω–∞ –æ—Ç</label>
                        <input
                            type="number"
                            placeholder="0"
                            v-model="minPrice"
                            @input="applyFilters"
                        >
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="filter-group">
                        <label>–¶–µ–Ω–∞ –¥–æ</label>
                        <input
                            type="number"
                            placeholder="10000000"
                            v-model="maxPrice"
                            @input="applyFilters"
                        >
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 col-sm-6">
                    <div class="filter-group">
                        <label>–ì–æ–¥</label>
                        <select v-model="selectedYear" @change="applyFilters">
                            <option value="">–í—Å–µ –≥–æ–¥—ã</option>
                            <option v-for="year in availableYears" :value="year">{{ year }}</option>
                        </select>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="filter-group">
                        <label>–¢–æ–ø–ª–∏–≤–æ</label>
                        <select v-model="selectedFuel" @change="applyFilters">
                            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                            <option v-for="fuel in availableFuels" :value="fuel">{{ getFuelName(fuel) }}</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
            <div class="mt-3">
                <label class="mb-2 d-block">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                <div class="sort-options">
                    <button
                        class="sort-btn"
                        :class="{ active: sortBy === 'price' }"
                        @click="changeSort('price')"
                    >
                        –ü–æ —Ü–µ–Ω–µ
                        <span v-if="sortBy === 'price'">
                            {{ sortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                        </span>
                    </button>
                    <button
                        class="sort-btn"
                        :class="{ active: sortBy === 'year' }"
                        @click="changeSort('year')"
                    >
                        –ü–æ –≥–æ–¥—É
                        <span v-if="sortBy === 'year'">
                            {{ sortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                        </span>
                    </button>
                    <button
                        class="sort-btn"
                        :class="{ active: sortBy === 'mileage' }"
                        @click="changeSort('mileage')"
                    >
                        –ü–æ –ø—Ä–æ–±–µ–≥—É
                        <span v-if="sortBy === 'mileage'">
                            {{ sortOrder === 'asc' ? '‚Üë' : '‚Üì' }}
                        </span>
                    </button>
                    <button class="sort-btn" @click="resetFilters">
                        <i class="fas fa-redo"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                </div>
            </div>
        </div>

        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div v-if="loading" class="loading-state">
            <div class="loading-spinner"></div>
            <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π...</h3>
            <p class="text-muted">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ</p>
        </div>

        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏ -->
        <div v-else-if="error" class="error-state">
            <i class="fas fa-exclamation-triangle mb-3"></i>
            <h4>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h4>
            <p>{{ error }}</p>
            <button @click="loadCars" class="btn btn-primary mt-3">
                <i class="fas fa-redo me-2"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>

        <!-- –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div v-else-if="filteredCars.length === 0" class="empty-state">
            <i class="fas fa-car"></i>
            <h3>–ê–≤—Ç–æ–º–æ–±–∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p class="text-muted mb-4">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
            <button @click="resetFilters" class="btn btn-primary">
                <i class="fas fa-filter me-2"></i> –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
            </button>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π -->
        <div v-else>
            <div class="cars-grid">
                <div v-for="car in filteredCars" :key="car.id" class="car-card">
                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –±–µ–π–¥–∂–∏ -->
                    <div class="car-image">
                        <img :src="car.image_url || 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341'"
                             :alt="car.brand_name + ' ' + car.model">

                        <div class="car-badges">
                            <span class="car-badge badge-year">{{ car.year }} –≥–æ–¥</span>
                            <span v-if="car.mileage < 10000" class="car-badge badge-new">–ù–æ–≤—ã–π</span>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
                        <button
                            class="favorite-btn"
                            :class="{ active: car.is_favorite }"
                            @click="toggleFavorite(car)"
                            :title="car.is_favorite ? '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'"
                        >
                            <i :class="car.is_favorite ? 'fas fa-heart' : 'far fa-heart'" :style="{ color: car.is_favorite ? 'white' : '#ef4444' }"></i>
                        </button>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ -->
                    <div class="car-content">
                        <h3 class="car-title">{{ car.brand_name }} {{ car.model }}</h3>

                        <div class="car-price">{{ formatPrice(car.price) }}</div>

                        <div class="car-details">
                            <div class="detail-item">
                                <i class="fas" :class="getIcon('fuel', car.fuel_type)"></i>
                                <span>{{ getFuelName(car.fuel_type) }}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas" :class="getIcon('transmission', car.transmission)"></i>
                                <span>{{ getTransmissionName(car.transmission) }}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-road"></i>
                                <span>{{ formatNumber(car.mileage) }} –∫–º</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-palette"></i>
                                <span>{{ car.color }}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>{{ car.engine_volume }} –ª / {{ car.horsepower }} –ª.—Å.</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-calendar"></i>
                                <span>{{ new Date(car.created_at).toLocaleDateString('ru-RU') }}</span>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                        <div class="car-actions">
                            <button class="btn-view" @click="viewCarDetails(car)">
                                <i class="fas fa-eye"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                            <button class="btn-request" @click="showRequestForm(car)">
                                <i class="fas fa-phone"></i> –ó–∞—è–≤–∫–∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div v-if="totalPages > 1" class="pagination">
                <button
                    class="page-btn"
                    @click="currentPage = page"
                    :class="{ active: currentPage === page }"
                    v-for="page in totalPages"
                    :key="page"
                >
                    {{ page }}
                </button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞—è–≤–∫–∏ -->
        <div v-if="showModal" class="modal-overlay" @click.self="showModal = false">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>–ó–∞—è–≤–∫–∞ –Ω–∞ {{ selectedCar?.brand_name }} {{ selectedCar?.model }}</h3>
                </div>

                <div class="modal-body">
                    <form @submit.prevent="submitRequest">
                        <div class="form-group">
                            <label>–ò–º—è *</label>
                            <input
                                type="text"
                                v-model="requestForm.name"
                                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input
                                type="tel"
                                v-model="requestForm.phone"
                                placeholder="+7 (999) 123-45-67"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label>Email *</label>
                            <input
                                type="email"
                                v-model="requestForm.email"
                                placeholder="example@mail.ru"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label>–°–æ–æ–±—â–µ–Ω–∏–µ</label>
                            <textarea
                                v-model="requestForm.message"
                                rows="4"
                                placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."
                            ></textarea>
                        </div>

                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                @click="showModal = false"
                            >
                                –û—Ç–º–µ–Ω–∞
                            </button>
                            <button
                                type="submit"
                                class="btn btn-primary"
                            >
                                <i class="fas fa-paper-plane me-2"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    `
}).mount('#app');

console.log('=== –ö–ê–¢–ê–õ–û–ì –ê–í–¢–û–ú–û–ë–ò–õ–ï–ô - Vue.js —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω ===');
</script>
{% endverbatim %}
{% endblock %}